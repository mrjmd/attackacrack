{% extends "base_authenticated.html" %}

{% block title %}Import from CSV{% endblock %}

{% block content %}
    <h2 class="text-3xl font-bold mb-6">Import Contacts from CSV</h2>
    
    <!-- Info Box -->
    <div class="bg-blue-900/30 border border-blue-600 rounded-lg p-4 mb-6">
        <div class="flex items-start space-x-3">
            <svg class="w-5 h-5 text-blue-400 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <div class="text-sm text-gray-300">
                <p class="font-semibold mb-1">Smart Format Detection</p>
                <p>This importer automatically detects and handles 10+ CSV formats including:</p>
                <ul class="mt-2 list-disc list-inside text-gray-400">
                    <li>OpenPhone exports</li>
                    <li>Realtor.com, Sotheby's, Vicente Realty</li>
                    <li>Exit Realty (Cape & Premier)</li>
                    <li>Jack Conway, Lamacchia, Raveis</li>
                    <li>PropertyRadar exports</li>
                    <li>Standard contact formats</li>
                </ul>
            </div>
        </div>
    </div>
    
    <div class="bg-gray-900 rounded-lg shadow p-6">
        <form method="POST" enctype="multipart/form-data" class="space-y-4">
            <div>
                <label for="file" class="block text-sm font-medium mb-2">CSV File:</label>
                <input type="file" id="file" name="file" accept=".csv" required 
                       class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2"
                       onchange="updateFileName(this)">
                <p id="file-name" class="text-sm text-gray-400 mt-2"></p>
            </div>
            
            <div>
                <label for="duplicate_strategy" class="block text-sm font-medium mb-2">Duplicate Handling:</label>
                <select id="duplicate_strategy" name="duplicate_strategy" 
                        class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2">
                    <option value="merge" selected>Merge - Only add missing fields (recommended)</option>
                    <option value="replace">Replace - Overwrite existing data with new data</option>
                    <option value="skip">Skip - Don't modify existing contacts</option>
                </select>
                <p class="text-xs text-gray-500 mt-1">
                    <span class="font-semibold">Merge:</span> Updates existing contacts only where data is missing<br>
                    <span class="font-semibold">Replace:</span> Overwrites all fields with new data<br>
                    <span class="font-semibold">Skip:</span> Ignores rows with existing phone numbers
                </p>
            </div>
            
            <!-- Features -->
            <div class="bg-gray-800 rounded-lg p-4">
                <p class="text-sm font-medium text-gray-300 mb-2">This import will:</p>
                <ul class="text-sm text-gray-400 space-y-1">
                    <li>✓ Automatically detect CSV format</li>
                    <li>✓ Normalize phone numbers to +1XXXXXXXXXX format</li>
                    <li>✓ Handle duplicates based on your selected strategy</li>
                    <li>✓ Add missing names, emails, and company info</li>
                    <li>✓ Store additional data in contact metadata</li>
                </ul>
            </div>
            
            <div class="flex items-center space-x-4">
                <button type="submit" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg">
                    Upload and Import
                </button>
                <a href="{{ url_for('settings.imports') }}" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-lg">
                    Cancel
                </a>
            </div>
        </form>
    </div>
    
    <script>
    function updateFileName(input) {
        const fileName = input.files[0]?.name || '';
        const fileNameEl = document.getElementById('file-name');
        if (fileName) {
            fileNameEl.textContent = `Selected: ${fileName}`;
            // Try to detect format from filename
            const formatHints = {
                'openphone': 'OpenPhone format detected',
                'realtor': 'Realtor.com format detected',
                'sotheby': 'Sotheby\'s format detected',
                'vicente': 'Vicente Realty format detected',
                'exitcape': 'Exit Realty Cape format detected',
                'exitpremier': 'Exit Realty Premier format detected',
                'jackconway': 'Jack Conway format detected',
                'lamacchia': 'Lamacchia format detected',
                'raveis': 'Raveis format detected',
                'propertyradar': 'PropertyRadar format detected',
                'cleaned_data_phone': 'PropertyRadar format detected'
            };
            
            const lowerName = fileName.toLowerCase();
            for (const [key, message] of Object.entries(formatHints)) {
                if (lowerName.includes(key)) {
                    fileNameEl.textContent += ` - ${message}`;
                    break;
                }
            }
        }
    }
    </script>
{% endblock %}
